(function(){var c=document.getElementById("canvas");var j=document.getElementById("mode");var g=document.getElementById("grass");var k=document.getElementsByTagName("body")[0];var i=document.getElementById("press");c.width=document.getElementsByTagName("body")[0].offsetWidth;c.height=document.getElementsByTagName("body")[0].offsetHeight;c.style.backgroundColor="#fff";var b=document.documentElement.clientWidth;var n=document.documentElement.clientHeight;window.ctx=c.getContext("2d");var d="light";j.onclick=function(o){d=d=="light"?"dark":"light";if(d=="dark"){window.ctx.clearRect(0,0,c.width,c.height);c.style.backgroundColor="#000";j.style.backgroundPositionY="-90px";g.style.backgroundPositionY="-90px";window.color="#fff";window.branches=[];var m=new f(new h(b/2,n),Math.round(window.random(6,10)),d,window.randomRgba());m.render()}else{window.ctx.clearRect(0,0,c.width,c.height);c.style.backgroundColor="#fff";j.style.backgroundPositionY="0px";g.style.backgroundPositionY="0px";window.color="#000";window.branches=[];var m=new f(new h(b/2,n),Math.round(window.random(6,10)),d,window.randomRgba());m.render()}window.stopBubble(o)};k.onclick=function(o){if(window.preTreeOk){var m=new f(new h(o.clientX,n),8,d,window.randomRgba());m.render()}};window.preTreeOk=true;window.random=function(o,m){return Math.random()*(m-o)+o};window.randomRgba=function(){var s=Math.round(window.random(0,255));var q=Math.round(window.random(0,255-s));var o=[255,s,q];var p=Math.round(window.random(0,2));var u=o[p];o.splice(p,1);p=Math.round(window.random(0,1));var t=o[p];o.splice(p,1);var m=o[0];return{r:u,g:t,b:m,a:1}};window.stopBubble=function(m){if(m&&m.stopPropagation){m.stopPropagation()}else{window.event.cancelBubble=true}};var h=function(m,o){this.x=m||0;this.y=o||0};h.prototype={add:function(m){this.x+=m.x;this.y+=m.y;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},rotate:function(m){this.x=Math.cos(m)*this.x-Math.sin(m)*this.y;this.y=Math.sin(m)*this.x+Math.cos(m)*this.y;return this}};var l=function(u,p,x,o,q,w,s,y){this.preDot=u||null;this.v=p||null;this.r=x||0;this.length=0;this.targetLength=window.random(s*3/4,s*4/5);this.generation=w||8;this.theta=q||0;this.forkPos=[];this.targetRgba=y||null;this.mode=o||"light";this.color=o=="light"?"rgba(0,0,0,1.0)":this.changeRgba();this.register()};var e=0;l.prototype={register:function(){this.v.rotate(this.theta);this.forkPosInit();f.addBranch(this)},draw:function(){window.ctx.beginPath();window.ctx.fillStyle=this.color;window.ctx.moveTo(this.preDot.x,this.preDot.y);window.ctx.arc(this.preDot.x,this.preDot.y,this.r,0,Math.PI*360/180,true);window.ctx.fill()},update:function(){this.preDot.add(this.v);this.length+=this.v.length();if(this.length>this.targetLength){f.removeBranch(this);this.fork(this,window.random(-0.1,0.1));return}if(this.length>this.targetLength*7/8&&this.forkPos[2].isfork){this.forkPos[2].isfork=false;this.fork(this,this.forkPos[2].forkd)}if(this.length>this.targetLength*3/4&&this.forkPos[1].isfork){this.forkPos[1].isfork=false;this.fork(this,this.forkPos[1].forkd)}if(this.length>this.targetLength*1/2&&this.forkPos[0].isfork){this.forkPos[0].isfork=false;this.fork(this,this.forkPos[0].forkd)}},fork:function(m,o){if(this.r<0.9){return}var p=new l(new h(m.preDot.x,m.preDot.y),new h(m.v.x,m.v.y),m.r*0.7,m.mode,o,m.generation+1,m.targetLength,m.targetRgba)},forkPosInit:function(){var o=0.8;var m=0.8;var q=0.4;var p=Math.random();this.forkPos[0]={isfork:Math.random()>o?false:true,forkd:p>0.5?-0.5:0.5};this.forkPos[1]={isfork:Math.random()>m?false:true,forkd:p>0.5?0.4:-0.4};this.forkPos[2]={isfork:Math.random()>q?false:true,forkd:Math.random()>0.8?-0.2:0.2}},changeRgba:function(){var q=255-(255-this.targetRgba.r)/8*this.generation;var p=255-(255-this.targetRgba.g)/8*this.generation;var m=255-(255-this.targetRgba.b)/8*this.generation;var o=1-this.generation/10;return"rgba("+q+","+p+","+m+","+o+")"},grow:function(){this.draw();this.update()}};var f=function(p,s,o,q){this.rootR=s||8;this.rootP=p||new h(b/2,n);this.treeMode=o||"light";this.targetRgba=q||{r:255,g:255,b:255,a:1};window.branches=[];window.timer=0;this.render=function(){window.preTreeOk=false;var m=this;window.timer=setInterval(function(){if(window.branches.length>0){for(var r=0;r<window.branches.length;r++){window.branches[r].grow()}}else{window.preTreeOk=true;clearInterval(window.timer)}},30)};this.init()};f.prototype={init:function(){var m=new l(this.rootP,new h(0,-2.5),this.rootR,this.treeMode,0,1,220,this.targetRgba)}};f.addBranch=function(m){window.branches.push(m)};f.removeBranch=function(m){for(var o=0;o<window.branches.length;o++){if(window.branches[o]===m){window.branches.splice(o,1);return}}};function a(){var m=new f(new h(b/2,n),10,"light",window.randomRgba());m.render();setTimeout(function(){i.style.transition="all 1.5s ease-in-out";i.style.top="80px";i.style.left=c.width-60+"px"},1000);setTimeout(function(){i.style.display="none"},3000)}a()}());